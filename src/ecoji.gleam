import gleam/iodata.{Iodata}
import gleam/bitwise
import gleam/io

external fn int_to_utf_codepoint(Int) -> UtfCodepoint =
  "gleam_stdlib" "identity"

fn utf_codepoint(value: Int) -> Result(UtfCodepoint, Nil) {
  case value {
    i if i > 1114111 -> Error(Nil)
    i if i == 65534 -> Error(Nil)
    i if i == 65535 -> Error(Nil)
    i if i >= 55296 && i <= 57343 -> Error(Nil)
    i -> Ok(int_to_utf_codepoint(i))
  }
}

// TODO: Use a BitStringBuilder type to remove the need for converting
// bitstrings to strings
external fn bit_string_to_string(BitString) -> String =
  "gleam_stdlib" "identity"

// TODO: use a standard library function
external fn string_to_bit_string(String) -> BitString =
  "gleam_stdlib" "identity"

// This is output when 3 or less input bytes are present.
fn padding() {
  assert Ok(x) = utf_codepoint(9749)
  x
}

// The following paddings are used when only 4 of 5 input bytes are present.
fn padding40() {
  assert Ok(x) = utf_codepoint(9884)
  x
}

fn padding41() {
  assert Ok(x) = utf_codepoint(127949)
  x
}

fn padding42() {
  assert Ok(x) = utf_codepoint(128209)
  x
}

fn padding43() {
  assert Ok(x) = utf_codepoint(128587)
  x
}

fn index_to_emoji(index: Int) -> UtfCodepoint {
  assert Ok(x) = case index {
    0 -> 126980
    1 -> 127183
    2 -> 127344
    3 -> 127345
    4 -> 127358
    5 -> 127359
    6 -> 127374
    7 -> 127377
    8 -> 127378
    9 -> 127379
    10 -> 127380
    11 -> 127381
    12 -> 127382
    13 -> 127383
    14 -> 127384
    15 -> 127385
    16 -> 127386
    17 -> 127462
    18 -> 127463
    19 -> 127464
    20 -> 127465
    21 -> 127466
    22 -> 127467
    23 -> 127468
    24 -> 127469
    25 -> 127470
    26 -> 127471
    27 -> 127472
    28 -> 127473
    29 -> 127474
    30 -> 127475
    31 -> 127476
    32 -> 127477
    33 -> 127478
    34 -> 127479
    35 -> 127480
    36 -> 127481
    37 -> 127482
    38 -> 127483
    39 -> 127484
    40 -> 127485
    41 -> 127486
    42 -> 127487
    43 -> 127489
    44 -> 127490
    45 -> 127514
    46 -> 127535
    47 -> 127538
    48 -> 127539
    49 -> 127540
    50 -> 127541
    51 -> 127542
    52 -> 127543
    53 -> 127544
    54 -> 127545
    55 -> 127546
    56 -> 127568
    57 -> 127569
    58 -> 127744
    59 -> 127745
    60 -> 127746
    61 -> 127747
    62 -> 127748
    63 -> 127749
    64 -> 127750
    65 -> 127751
    66 -> 127752
    67 -> 127753
    68 -> 127754
    69 -> 127755
    70 -> 127756
    71 -> 127757
    72 -> 127758
    73 -> 127759
    74 -> 127760
    75 -> 127761
    76 -> 127762
    77 -> 127763
    78 -> 127764
    79 -> 127765
    80 -> 127766
    81 -> 127767
    82 -> 127768
    83 -> 127769
    84 -> 127770
    85 -> 127771
    86 -> 127772
    87 -> 127773
    88 -> 127774
    89 -> 127775
    90 -> 127776
    91 -> 127777
    92 -> 127780
    93 -> 127781
    94 -> 127782
    95 -> 127783
    96 -> 127784
    97 -> 127785
    98 -> 127786
    99 -> 127787
    100 -> 127788
    101 -> 127789
    102 -> 127790
    103 -> 127791
    104 -> 127792
    105 -> 127793
    106 -> 127794
    107 -> 127795
    108 -> 127796
    109 -> 127797
    110 -> 127798
    111 -> 127799
    112 -> 127800
    113 -> 127801
    114 -> 127802
    115 -> 127803
    116 -> 127804
    117 -> 127805
    118 -> 127806
    119 -> 127807
    120 -> 127808
    121 -> 127809
    122 -> 127810
    123 -> 127811
    124 -> 127812
    125 -> 127813
    126 -> 127814
    127 -> 127815
    128 -> 127816
    129 -> 127817
    130 -> 127818
    131 -> 127819
    132 -> 127820
    133 -> 127821
    134 -> 127822
    135 -> 127823
    136 -> 127824
    137 -> 127825
    138 -> 127826
    139 -> 127827
    140 -> 127828
    141 -> 127829
    142 -> 127830
    143 -> 127831
    144 -> 127832
    145 -> 127833
    146 -> 127834
    147 -> 127835
    148 -> 127836
    149 -> 127837
    150 -> 127838
    151 -> 127839
    152 -> 127840
    153 -> 127841
    154 -> 127842
    155 -> 127843
    156 -> 127844
    157 -> 127845
    158 -> 127846
    159 -> 127847
    160 -> 127848
    161 -> 127849
    162 -> 127850
    163 -> 127851
    164 -> 127852
    165 -> 127853
    166 -> 127854
    167 -> 127855
    168 -> 127856
    169 -> 127857
    170 -> 127858
    171 -> 127859
    172 -> 127860
    173 -> 127861
    174 -> 127862
    175 -> 127863
    176 -> 127864
    177 -> 127865
    178 -> 127866
    179 -> 127867
    180 -> 127868
    181 -> 127869
    182 -> 127870
    183 -> 127871
    184 -> 127872
    185 -> 127873
    186 -> 127874
    187 -> 127875
    188 -> 127876
    189 -> 127877
    190 -> 127878
    191 -> 127879
    192 -> 127880
    193 -> 127881
    194 -> 127882
    195 -> 127883
    196 -> 127884
    197 -> 127885
    198 -> 127886
    199 -> 127887
    200 -> 127888
    201 -> 127889
    202 -> 127890
    203 -> 127891
    204 -> 127894
    205 -> 127895
    206 -> 127897
    207 -> 127898
    208 -> 127899
    209 -> 127902
    210 -> 127903
    211 -> 127904
    212 -> 127905
    213 -> 127906
    214 -> 127907
    215 -> 127908
    216 -> 127909
    217 -> 127910
    218 -> 127911
    219 -> 127912
    220 -> 127913
    221 -> 127914
    222 -> 127915
    223 -> 127916
    224 -> 127917
    225 -> 127918
    226 -> 127919
    227 -> 127920
    228 -> 127921
    229 -> 127922
    230 -> 127923
    231 -> 127924
    232 -> 127925
    233 -> 127926
    234 -> 127927
    235 -> 127928
    236 -> 127929
    237 -> 127930
    238 -> 127931
    239 -> 127932
    240 -> 127933
    241 -> 127934
    242 -> 127935
    243 -> 127936
    244 -> 127937
    245 -> 127938
    246 -> 127939
    247 -> 127940
    248 -> 127941
    249 -> 127942
    250 -> 127943
    251 -> 127944
    252 -> 127945
    253 -> 127946
    254 -> 127947
    255 -> 127948
    256 -> 127950
    257 -> 127951
    258 -> 127952
    259 -> 127953
    260 -> 127954
    261 -> 127955
    262 -> 127956
    263 -> 127957
    264 -> 127958
    265 -> 127959
    266 -> 127960
    267 -> 127961
    268 -> 127962
    269 -> 127963
    270 -> 127964
    271 -> 127965
    272 -> 127966
    273 -> 127967
    274 -> 127968
    275 -> 127969
    276 -> 127970
    277 -> 127971
    278 -> 127972
    279 -> 127973
    280 -> 127974
    281 -> 127975
    282 -> 127976
    283 -> 127977
    284 -> 127978
    285 -> 127979
    286 -> 127980
    287 -> 127981
    288 -> 127982
    289 -> 127983
    290 -> 127984
    291 -> 127987
    292 -> 127988
    293 -> 127989
    294 -> 127991
    295 -> 127992
    296 -> 127993
    297 -> 127994
    298 -> 127995
    299 -> 127996
    300 -> 127997
    301 -> 127998
    302 -> 127999
    303 -> 128000
    304 -> 128001
    305 -> 128002
    306 -> 128003
    307 -> 128004
    308 -> 128005
    309 -> 128006
    310 -> 128007
    311 -> 128008
    312 -> 128009
    313 -> 128010
    314 -> 128011
    315 -> 128012
    316 -> 128013
    317 -> 128014
    318 -> 128015
    319 -> 128016
    320 -> 128017
    321 -> 128018
    322 -> 128019
    323 -> 128020
    324 -> 128021
    325 -> 128022
    326 -> 128023
    327 -> 128024
    328 -> 128025
    329 -> 128026
    330 -> 128027
    331 -> 128028
    332 -> 128029
    333 -> 128030
    334 -> 128031
    335 -> 128032
    336 -> 128033
    337 -> 128034
    338 -> 128035
    339 -> 128036
    340 -> 128037
    341 -> 128038
    342 -> 128039
    343 -> 128040
    344 -> 128041
    345 -> 128042
    346 -> 128043
    347 -> 128044
    348 -> 128045
    349 -> 128046
    350 -> 128047
    351 -> 128048
    352 -> 128049
    353 -> 128050
    354 -> 128051
    355 -> 128052
    356 -> 128053
    357 -> 128054
    358 -> 128055
    359 -> 128056
    360 -> 128057
    361 -> 128058
    362 -> 128059
    363 -> 128060
    364 -> 128061
    365 -> 128062
    366 -> 128063
    367 -> 128064
    368 -> 128065
    369 -> 128066
    370 -> 128067
    371 -> 128068
    372 -> 128069
    373 -> 128070
    374 -> 128071
    375 -> 128072
    376 -> 128073
    377 -> 128074
    378 -> 128075
    379 -> 128076
    380 -> 128077
    381 -> 128078
    382 -> 128079
    383 -> 128080
    384 -> 128081
    385 -> 128082
    386 -> 128083
    387 -> 128084
    388 -> 128085
    389 -> 128086
    390 -> 128087
    391 -> 128088
    392 -> 128089
    393 -> 128090
    394 -> 128091
    395 -> 128092
    396 -> 128093
    397 -> 128094
    398 -> 128095
    399 -> 128096
    400 -> 128097
    401 -> 128098
    402 -> 128099
    403 -> 128100
    404 -> 128101
    405 -> 128102
    406 -> 128103
    407 -> 128104
    408 -> 128105
    409 -> 128106
    410 -> 128107
    411 -> 128108
    412 -> 128109
    413 -> 128110
    414 -> 128111
    415 -> 128112
    416 -> 128113
    417 -> 128114
    418 -> 128115
    419 -> 128116
    420 -> 128117
    421 -> 128118
    422 -> 128119
    423 -> 128120
    424 -> 128121
    425 -> 128122
    426 -> 128123
    427 -> 128124
    428 -> 128125
    429 -> 128126
    430 -> 128127
    431 -> 128128
    432 -> 128129
    433 -> 128130
    434 -> 128131
    435 -> 128132
    436 -> 128133
    437 -> 128134
    438 -> 128135
    439 -> 128136
    440 -> 128137
    441 -> 128138
    442 -> 128139
    443 -> 128140
    444 -> 128141
    445 -> 128142
    446 -> 128143
    447 -> 128144
    448 -> 128145
    449 -> 128146
    450 -> 128147
    451 -> 128148
    452 -> 128149
    453 -> 128150
    454 -> 128151
    455 -> 128152
    456 -> 128153
    457 -> 128154
    458 -> 128155
    459 -> 128156
    460 -> 128157
    461 -> 128158
    462 -> 128159
    463 -> 128160
    464 -> 128161
    465 -> 128162
    466 -> 128163
    467 -> 128164
    468 -> 128165
    469 -> 128166
    470 -> 128167
    471 -> 128168
    472 -> 128169
    473 -> 128170
    474 -> 128171
    475 -> 128172
    476 -> 128173
    477 -> 128174
    478 -> 128175
    479 -> 128176
    480 -> 128177
    481 -> 128178
    482 -> 128179
    483 -> 128180
    484 -> 128181
    485 -> 128182
    486 -> 128183
    487 -> 128184
    488 -> 128185
    489 -> 128186
    490 -> 128187
    491 -> 128188
    492 -> 128189
    493 -> 128190
    494 -> 128191
    495 -> 128192
    496 -> 128193
    497 -> 128194
    498 -> 128195
    499 -> 128196
    500 -> 128197
    501 -> 128198
    502 -> 128199
    503 -> 128200
    504 -> 128201
    505 -> 128202
    506 -> 128203
    507 -> 128204
    508 -> 128205
    509 -> 128206
    510 -> 128207
    511 -> 128208
    512 -> 128210
    513 -> 128211
    514 -> 128212
    515 -> 128213
    516 -> 128214
    517 -> 128215
    518 -> 128216
    519 -> 128217
    520 -> 128218
    521 -> 128219
    522 -> 128220
    523 -> 128221
    524 -> 128222
    525 -> 128223
    526 -> 128224
    527 -> 128225
    528 -> 128226
    529 -> 128227
    530 -> 128228
    531 -> 128229
    532 -> 128230
    533 -> 128231
    534 -> 128232
    535 -> 128233
    536 -> 128234
    537 -> 128235
    538 -> 128236
    539 -> 128237
    540 -> 128238
    541 -> 128239
    542 -> 128240
    543 -> 128241
    544 -> 128242
    545 -> 128243
    546 -> 128244
    547 -> 128245
    548 -> 128246
    549 -> 128247
    550 -> 128248
    551 -> 128249
    552 -> 128250
    553 -> 128251
    554 -> 128252
    555 -> 128253
    556 -> 128255
    557 -> 128256
    558 -> 128257
    559 -> 128258
    560 -> 128259
    561 -> 128260
    562 -> 128261
    563 -> 128262
    564 -> 128263
    565 -> 128264
    566 -> 128265
    567 -> 128266
    568 -> 128267
    569 -> 128268
    570 -> 128269
    571 -> 128270
    572 -> 128271
    573 -> 128272
    574 -> 128273
    575 -> 128274
    576 -> 128275
    577 -> 128276
    578 -> 128277
    579 -> 128278
    580 -> 128279
    581 -> 128280
    582 -> 128281
    583 -> 128282
    584 -> 128283
    585 -> 128284
    586 -> 128285
    587 -> 128286
    588 -> 128287
    589 -> 128288
    590 -> 128289
    591 -> 128290
    592 -> 128291
    593 -> 128292
    594 -> 128293
    595 -> 128294
    596 -> 128295
    597 -> 128296
    598 -> 128297
    599 -> 128298
    600 -> 128299
    601 -> 128300
    602 -> 128301
    603 -> 128302
    604 -> 128303
    605 -> 128304
    606 -> 128305
    607 -> 128306
    608 -> 128307
    609 -> 128308
    610 -> 128309
    611 -> 128310
    612 -> 128311
    613 -> 128312
    614 -> 128313
    615 -> 128314
    616 -> 128315
    617 -> 128316
    618 -> 128317
    619 -> 128329
    620 -> 128330
    621 -> 128331
    622 -> 128332
    623 -> 128333
    624 -> 128334
    625 -> 128336
    626 -> 128337
    627 -> 128338
    628 -> 128339
    629 -> 128340
    630 -> 128341
    631 -> 128342
    632 -> 128343
    633 -> 128344
    634 -> 128345
    635 -> 128346
    636 -> 128347
    637 -> 128348
    638 -> 128349
    639 -> 128350
    640 -> 128351
    641 -> 128352
    642 -> 128353
    643 -> 128354
    644 -> 128355
    645 -> 128356
    646 -> 128357
    647 -> 128358
    648 -> 128359
    649 -> 128367
    650 -> 128368
    651 -> 128371
    652 -> 128372
    653 -> 128373
    654 -> 128374
    655 -> 128375
    656 -> 128376
    657 -> 128377
    658 -> 128378
    659 -> 128391
    660 -> 128394
    661 -> 128395
    662 -> 128396
    663 -> 128397
    664 -> 128400
    665 -> 128405
    666 -> 128406
    667 -> 128420
    668 -> 128421
    669 -> 128424
    670 -> 128433
    671 -> 128434
    672 -> 128444
    673 -> 128450
    674 -> 128451
    675 -> 128452
    676 -> 128465
    677 -> 128466
    678 -> 128467
    679 -> 128476
    680 -> 128477
    681 -> 128478
    682 -> 128481
    683 -> 128483
    684 -> 128488
    685 -> 128495
    686 -> 128499
    687 -> 128506
    688 -> 128507
    689 -> 128508
    690 -> 128509
    691 -> 128510
    692 -> 128511
    693 -> 128512
    694 -> 128513
    695 -> 128514
    696 -> 128515
    697 -> 128516
    698 -> 128517
    699 -> 128518
    700 -> 128519
    701 -> 128520
    702 -> 128521
    703 -> 128522
    704 -> 128523
    705 -> 128524
    706 -> 128525
    707 -> 128526
    708 -> 128527
    709 -> 128528
    710 -> 128529
    711 -> 128530
    712 -> 128531
    713 -> 128532
    714 -> 128533
    715 -> 128534
    716 -> 128535
    717 -> 128536
    718 -> 128537
    719 -> 128538
    720 -> 128539
    721 -> 128540
    722 -> 128541
    723 -> 128542
    724 -> 128543
    725 -> 128544
    726 -> 128545
    727 -> 128546
    728 -> 128547
    729 -> 128548
    730 -> 128549
    731 -> 128550
    732 -> 128551
    733 -> 128552
    734 -> 128553
    735 -> 128554
    736 -> 128555
    737 -> 128556
    738 -> 128557
    739 -> 128558
    740 -> 128559
    741 -> 128560
    742 -> 128561
    743 -> 128562
    744 -> 128563
    745 -> 128564
    746 -> 128565
    747 -> 128566
    748 -> 128567
    749 -> 128568
    750 -> 128569
    751 -> 128570
    752 -> 128571
    753 -> 128572
    754 -> 128573
    755 -> 128574
    756 -> 128575
    757 -> 128576
    758 -> 128577
    759 -> 128578
    760 -> 128579
    761 -> 128580
    762 -> 128581
    763 -> 128582
    764 -> 128583
    765 -> 128584
    766 -> 128585
    767 -> 128586
    768 -> 128588
    769 -> 128589
    770 -> 128590
    771 -> 128591
    772 -> 128640
    773 -> 128641
    774 -> 128642
    775 -> 128643
    776 -> 128644
    777 -> 128645
    778 -> 128646
    779 -> 128647
    780 -> 128648
    781 -> 128649
    782 -> 128650
    783 -> 128651
    784 -> 128652
    785 -> 128653
    786 -> 128654
    787 -> 128655
    788 -> 128656
    789 -> 128657
    790 -> 128658
    791 -> 128659
    792 -> 128660
    793 -> 128661
    794 -> 128662
    795 -> 128663
    796 -> 128664
    797 -> 128665
    798 -> 128666
    799 -> 128667
    800 -> 128668
    801 -> 128669
    802 -> 128670
    803 -> 128671
    804 -> 128672
    805 -> 128673
    806 -> 128674
    807 -> 128675
    808 -> 128676
    809 -> 128677
    810 -> 128678
    811 -> 128679
    812 -> 128680
    813 -> 128681
    814 -> 128682
    815 -> 128683
    816 -> 128684
    817 -> 128685
    818 -> 128686
    819 -> 128687
    820 -> 128688
    821 -> 128689
    822 -> 128690
    823 -> 128691
    824 -> 128692
    825 -> 128693
    826 -> 128694
    827 -> 128695
    828 -> 128696
    829 -> 128697
    830 -> 128698
    831 -> 128699
    832 -> 128700
    833 -> 128701
    834 -> 128702
    835 -> 128703
    836 -> 128704
    837 -> 128705
    838 -> 128706
    839 -> 128707
    840 -> 128708
    841 -> 128709
    842 -> 128715
    843 -> 128716
    844 -> 128717
    845 -> 128718
    846 -> 128719
    847 -> 128720
    848 -> 128721
    849 -> 128722
    850 -> 128736
    851 -> 128737
    852 -> 128738
    853 -> 128739
    854 -> 128740
    855 -> 128741
    856 -> 128745
    857 -> 128747
    858 -> 128748
    859 -> 128752
    860 -> 128755
    861 -> 128756
    862 -> 128757
    863 -> 128758
    864 -> 128759
    865 -> 128760
    866 -> 128761
    867 -> 129296
    868 -> 129297
    869 -> 129298
    870 -> 129299
    871 -> 129300
    872 -> 129301
    873 -> 129302
    874 -> 129303
    875 -> 129304
    876 -> 129305
    877 -> 129306
    878 -> 129307
    879 -> 129308
    880 -> 129309
    881 -> 129310
    882 -> 129311
    883 -> 129312
    884 -> 129313
    885 -> 129314
    886 -> 129315
    887 -> 129316
    888 -> 129317
    889 -> 129318
    890 -> 129319
    891 -> 129320
    892 -> 129321
    893 -> 129322
    894 -> 129323
    895 -> 129324
    896 -> 129325
    897 -> 129326
    898 -> 129327
    899 -> 129328
    900 -> 129329
    901 -> 129330
    902 -> 129331
    903 -> 129332
    904 -> 129333
    905 -> 129334
    906 -> 129335
    907 -> 129336
    908 -> 129337
    909 -> 129338
    910 -> 129340
    911 -> 129341
    912 -> 129342
    913 -> 129344
    914 -> 129345
    915 -> 129346
    916 -> 129347
    917 -> 129348
    918 -> 129349
    919 -> 129351
    920 -> 129352
    921 -> 129353
    922 -> 129354
    923 -> 129355
    924 -> 129356
    925 -> 129357
    926 -> 129358
    927 -> 129359
    928 -> 129360
    929 -> 129361
    930 -> 129362
    931 -> 129363
    932 -> 129364
    933 -> 129365
    934 -> 129366
    935 -> 129367
    936 -> 129368
    937 -> 129369
    938 -> 129370
    939 -> 129371
    940 -> 129372
    941 -> 129373
    942 -> 129374
    943 -> 129375
    944 -> 129376
    945 -> 129377
    946 -> 129378
    947 -> 129379
    948 -> 129380
    949 -> 129381
    950 -> 129382
    951 -> 129383
    952 -> 129384
    953 -> 129385
    954 -> 129386
    955 -> 129387
    956 -> 129388
    957 -> 129389
    958 -> 129390
    959 -> 129391
    960 -> 129392
    961 -> 129395
    962 -> 129396
    963 -> 129397
    964 -> 129398
    965 -> 129402
    966 -> 129404
    967 -> 129405
    968 -> 129406
    969 -> 129407
    970 -> 129408
    971 -> 129409
    972 -> 129410
    973 -> 129411
    974 -> 129412
    975 -> 129413
    976 -> 129414
    977 -> 129415
    978 -> 129416
    979 -> 129417
    980 -> 129418
    981 -> 129419
    982 -> 129420
    983 -> 129421
    984 -> 129422
    985 -> 129423
    986 -> 129424
    987 -> 129425
    988 -> 129426
    989 -> 129427
    990 -> 129428
    991 -> 129429
    992 -> 129430
    993 -> 129431
    994 -> 129432
    995 -> 129433
    996 -> 129434
    997 -> 129435
    998 -> 129436
    999 -> 129437
    1000 -> 129438
    1001 -> 129439
    1002 -> 129440
    1003 -> 129441
    1004 -> 129442
    1005 -> 129456
    1006 -> 129457
    1007 -> 129458
    1008 -> 129459
    1009 -> 129460
    1010 -> 129461
    1011 -> 129462
    1012 -> 129463
    1013 -> 129464
    1014 -> 129465
    1015 -> 129472
    1016 -> 129473
    1017 -> 129474
    1018 -> 129488
    1019 -> 129489
    1020 -> 129490
    1021 -> 129491
    1022 -> 129492
    1023 -> 129493
    // fallback. This should never happen
    _ -> 126980
  }
  |> utf_codepoint
  x
}

// fn emoji_to_index(emoji: UtfCodepoint) -> Int {
//   case emoji {
//     126980 -> 0
//     127183 -> 1
//     127344 -> 2
//     127345 -> 3
//     127358 -> 4
//     127359 -> 5
//     127374 -> 6
//     127377 -> 7
//     127378 -> 8
//     127379 -> 9
//     127380 -> 10
//     127381 -> 11
//     127382 -> 12
//     127383 -> 13
//     127384 -> 14
//     127385 -> 15
//     127386 -> 16
//     127462 -> 17
//     127463 -> 18
//     127464 -> 19
//     127465 -> 20
//     127466 -> 21
//     127467 -> 22
//     127468 -> 23
//     127469 -> 24
//     127470 -> 25
//     127471 -> 26
//     127472 -> 27
//     127473 -> 28
//     127474 -> 29
//     127475 -> 30
//     127476 -> 31
//     127477 -> 32
//     127478 -> 33
//     127479 -> 34
//     127480 -> 35
//     127481 -> 36
//     127482 -> 37
//     127483 -> 38
//     127484 -> 39
//     127485 -> 40
//     127486 -> 41
//     127487 -> 42
//     127489 -> 43
//     127490 -> 44
//     127514 -> 45
//     127535 -> 46
//     127538 -> 47
//     127539 -> 48
//     127540 -> 49
//     127541 -> 50
//     127542 -> 51
//     127543 -> 52
//     127544 -> 53
//     127545 -> 54
//     127546 -> 55
//     127568 -> 56
//     127569 -> 57
//     127744 -> 58
//     127745 -> 59
//     127746 -> 60
//     127747 -> 61
//     127748 -> 62
//     127749 -> 63
//     127750 -> 64
//     127751 -> 65
//     127752 -> 66
//     127753 -> 67
//     127754 -> 68
//     127755 -> 69
//     127756 -> 70
//     127757 -> 71
//     127758 -> 72
//     127759 -> 73
//     127760 -> 74
//     127761 -> 75
//     127762 -> 76
//     127763 -> 77
//     127764 -> 78
//     127765 -> 79
//     127766 -> 80
//     127767 -> 81
//     127768 -> 82
//     127769 -> 83
//     127770 -> 84
//     127771 -> 85
//     127772 -> 86
//     127773 -> 87
//     127774 -> 88
//     127775 -> 89
//     127776 -> 90
//     127777 -> 91
//     127780 -> 92
//     127781 -> 93
//     127782 -> 94
//     127783 -> 95
//     127784 -> 96
//     127785 -> 97
//     127786 -> 98
//     127787 -> 99
//     127788 -> 100
//     127789 -> 101
//     127790 -> 102
//     127791 -> 103
//     127792 -> 104
//     127793 -> 105
//     127794 -> 106
//     127795 -> 107
//     127796 -> 108
//     127797 -> 109
//     127798 -> 110
//     127799 -> 111
//     127800 -> 112
//     127801 -> 113
//     127802 -> 114
//     127803 -> 115
//     127804 -> 116
//     127805 -> 117
//     127806 -> 118
//     127807 -> 119
//     127808 -> 120
//     127809 -> 121
//     127810 -> 122
//     127811 -> 123
//     127812 -> 124
//     127813 -> 125
//     127814 -> 126
//     127815 -> 127
//     127816 -> 128
//     127817 -> 129
//     127818 -> 130
//     127819 -> 131
//     127820 -> 132
//     127821 -> 133
//     127822 -> 134
//     127823 -> 135
//     127824 -> 136
//     127825 -> 137
//     127826 -> 138
//     127827 -> 139
//     127828 -> 140
//     127829 -> 141
//     127830 -> 142
//     127831 -> 143
//     127832 -> 144
//     127833 -> 145
//     127834 -> 146
//     127835 -> 147
//     127836 -> 148
//     127837 -> 149
//     127838 -> 150
//     127839 -> 151
//     127840 -> 152
//     127841 -> 153
//     127842 -> 154
//     127843 -> 155
//     127844 -> 156
//     127845 -> 157
//     127846 -> 158
//     127847 -> 159
//     127848 -> 160
//     127849 -> 161
//     127850 -> 162
//     127851 -> 163
//     127852 -> 164
//     127853 -> 165
//     127854 -> 166
//     127855 -> 167
//     127856 -> 168
//     127857 -> 169
//     127858 -> 170
//     127859 -> 171
//     127860 -> 172
//     127861 -> 173
//     127862 -> 174
//     127863 -> 175
//     127864 -> 176
//     127865 -> 177
//     127866 -> 178
//     127867 -> 179
//     127868 -> 180
//     127869 -> 181
//     127870 -> 182
//     127871 -> 183
//     127872 -> 184
//     127873 -> 185
//     127874 -> 186
//     127875 -> 187
//     127876 -> 188
//     127877 -> 189
//     127878 -> 190
//     127879 -> 191
//     127880 -> 192
//     127881 -> 193
//     127882 -> 194
//     127883 -> 195
//     127884 -> 196
//     127885 -> 197
//     127886 -> 198
//     127887 -> 199
//     127888 -> 200
//     127889 -> 201
//     127890 -> 202
//     127891 -> 203
//     127894 -> 204
//     127895 -> 205
//     127897 -> 206
//     127898 -> 207
//     127899 -> 208
//     127902 -> 209
//     127903 -> 210
//     127904 -> 211
//     127905 -> 212
//     127906 -> 213
//     127907 -> 214
//     127908 -> 215
//     127909 -> 216
//     127910 -> 217
//     127911 -> 218
//     127912 -> 219
//     127913 -> 220
//     127914 -> 221
//     127915 -> 222
//     127916 -> 223
//     127917 -> 224
//     127918 -> 225
//     127919 -> 226
//     127920 -> 227
//     127921 -> 228
//     127922 -> 229
//     127923 -> 230
//     127924 -> 231
//     127925 -> 232
//     127926 -> 233
//     127927 -> 234
//     127928 -> 235
//     127929 -> 236
//     127930 -> 237
//     127931 -> 238
//     127932 -> 239
//     127933 -> 240
//     127934 -> 241
//     127935 -> 242
//     127936 -> 243
//     127937 -> 244
//     127938 -> 245
//     127939 -> 246
//     127940 -> 247
//     127941 -> 248
//     127942 -> 249
//     127943 -> 250
//     127944 -> 251
//     127945 -> 252
//     127946 -> 253
//     127947 -> 254
//     127948 -> 255
//     127950 -> 256
//     127951 -> 257
//     127952 -> 258
//     127953 -> 259
//     127954 -> 260
//     127955 -> 261
//     127956 -> 262
//     127957 -> 263
//     127958 -> 264
//     127959 -> 265
//     127960 -> 266
//     127961 -> 267
//     127962 -> 268
//     127963 -> 269
//     127964 -> 270
//     127965 -> 271
//     127966 -> 272
//     127967 -> 273
//     127968 -> 274
//     127969 -> 275
//     127970 -> 276
//     127971 -> 277
//     127972 -> 278
//     127973 -> 279
//     127974 -> 280
//     127975 -> 281
//     127976 -> 282
//     127977 -> 283
//     127978 -> 284
//     127979 -> 285
//     127980 -> 286
//     127981 -> 287
//     127982 -> 288
//     127983 -> 289
//     127984 -> 290
//     127987 -> 291
//     127988 -> 292
//     127989 -> 293
//     127991 -> 294
//     127992 -> 295
//     127993 -> 296
//     127994 -> 297
//     127995 -> 298
//     127996 -> 299
//     127997 -> 300
//     127998 -> 301
//     127999 -> 302
//     128000 -> 303
//     128001 -> 304
//     128002 -> 305
//     128003 -> 306
//     128004 -> 307
//     128005 -> 308
//     128006 -> 309
//     128007 -> 310
//     128008 -> 311
//     128009 -> 312
//     128010 -> 313
//     128011 -> 314
//     128012 -> 315
//     128013 -> 316
//     128014 -> 317
//     128015 -> 318
//     128016 -> 319
//     128017 -> 320
//     128018 -> 321
//     128019 -> 322
//     128020 -> 323
//     128021 -> 324
//     128022 -> 325
//     128023 -> 326
//     128024 -> 327
//     128025 -> 328
//     128026 -> 329
//     128027 -> 330
//     128028 -> 331
//     128029 -> 332
//     128030 -> 333
//     128031 -> 334
//     128032 -> 335
//     128033 -> 336
//     128034 -> 337
//     128035 -> 338
//     128036 -> 339
//     128037 -> 340
//     128038 -> 341
//     128039 -> 342
//     128040 -> 343
//     128041 -> 344
//     128042 -> 345
//     128043 -> 346
//     128044 -> 347
//     128045 -> 348
//     128046 -> 349
//     128047 -> 350
//     128048 -> 351
//     128049 -> 352
//     128050 -> 353
//     128051 -> 354
//     128052 -> 355
//     128053 -> 356
//     128054 -> 357
//     128055 -> 358
//     128056 -> 359
//     128057 -> 360
//     128058 -> 361
//     128059 -> 362
//     128060 -> 363
//     128061 -> 364
//     128062 -> 365
//     128063 -> 366
//     128064 -> 367
//     128065 -> 368
//     128066 -> 369
//     128067 -> 370
//     128068 -> 371
//     128069 -> 372
//     128070 -> 373
//     128071 -> 374
//     128072 -> 375
//     128073 -> 376
//     128074 -> 377
//     128075 -> 378
//     128076 -> 379
//     128077 -> 380
//     128078 -> 381
//     128079 -> 382
//     128080 -> 383
//     128081 -> 384
//     128082 -> 385
//     128083 -> 386
//     128084 -> 387
//     128085 -> 388
//     128086 -> 389
//     128087 -> 390
//     128088 -> 391
//     128089 -> 392
//     128090 -> 393
//     128091 -> 394
//     128092 -> 395
//     128093 -> 396
//     128094 -> 397
//     128095 -> 398
//     128096 -> 399
//     128097 -> 400
//     128098 -> 401
//     128099 -> 402
//     128100 -> 403
//     128101 -> 404
//     128102 -> 405
//     128103 -> 406
//     128104 -> 407
//     128105 -> 408
//     128106 -> 409
//     128107 -> 410
//     128108 -> 411
//     128109 -> 412
//     128110 -> 413
//     128111 -> 414
//     128112 -> 415
//     128113 -> 416
//     128114 -> 417
//     128115 -> 418
//     128116 -> 419
//     128117 -> 420
//     128118 -> 421
//     128119 -> 422
//     128120 -> 423
//     128121 -> 424
//     128122 -> 425
//     128123 -> 426
//     128124 -> 427
//     128125 -> 428
//     128126 -> 429
//     128127 -> 430
//     128128 -> 431
//     128129 -> 432
//     128130 -> 433
//     128131 -> 434
//     128132 -> 435
//     128133 -> 436
//     128134 -> 437
//     128135 -> 438
//     128136 -> 439
//     128137 -> 440
//     128138 -> 441
//     128139 -> 442
//     128140 -> 443
//     128141 -> 444
//     128142 -> 445
//     128143 -> 446
//     128144 -> 447
//     128145 -> 448
//     128146 -> 449
//     128147 -> 450
//     128148 -> 451
//     128149 -> 452
//     128150 -> 453
//     128151 -> 454
//     128152 -> 455
//     128153 -> 456
//     128154 -> 457
//     128155 -> 458
//     128156 -> 459
//     128157 -> 460
//     128158 -> 461
//     128159 -> 462
//     128160 -> 463
//     128161 -> 464
//     128162 -> 465
//     128163 -> 466
//     128164 -> 467
//     128165 -> 468
//     128166 -> 469
//     128167 -> 470
//     128168 -> 471
//     128169 -> 472
//     128170 -> 473
//     128171 -> 474
//     128172 -> 475
//     128173 -> 476
//     128174 -> 477
//     128175 -> 478
//     128176 -> 479
//     128177 -> 480
//     128178 -> 481
//     128179 -> 482
//     128180 -> 483
//     128181 -> 484
//     128182 -> 485
//     128183 -> 486
//     128184 -> 487
//     128185 -> 488
//     128186 -> 489
//     128187 -> 490
//     128188 -> 491
//     128189 -> 492
//     128190 -> 493
//     128191 -> 494
//     128192 -> 495
//     128193 -> 496
//     128194 -> 497
//     128195 -> 498
//     128196 -> 499
//     128197 -> 500
//     128198 -> 501
//     128199 -> 502
//     128200 -> 503
//     128201 -> 504
//     128202 -> 505
//     128203 -> 506
//     128204 -> 507
//     128205 -> 508
//     128206 -> 509
//     128207 -> 510
//     128208 -> 511
//     128210 -> 512
//     128211 -> 513
//     128212 -> 514
//     128213 -> 515
//     128214 -> 516
//     128215 -> 517
//     128216 -> 518
//     128217 -> 519
//     128218 -> 520
//     128219 -> 521
//     128220 -> 522
//     128221 -> 523
//     128222 -> 524
//     128223 -> 525
//     128224 -> 526
//     128225 -> 527
//     128226 -> 528
//     128227 -> 529
//     128228 -> 530
//     128229 -> 531
//     128230 -> 532
//     128231 -> 533
//     128232 -> 534
//     128233 -> 535
//     128234 -> 536
//     128235 -> 537
//     128236 -> 538
//     128237 -> 539
//     128238 -> 540
//     128239 -> 541
//     128240 -> 542
//     128241 -> 543
//     128242 -> 544
//     128243 -> 545
//     128244 -> 546
//     128245 -> 547
//     128246 -> 548
//     128247 -> 549
//     128248 -> 550
//     128249 -> 551
//     128250 -> 552
//     128251 -> 553
//     128252 -> 554
//     128253 -> 555
//     128255 -> 556
//     128256 -> 557
//     128257 -> 558
//     128258 -> 559
//     128259 -> 560
//     128260 -> 561
//     128261 -> 562
//     128262 -> 563
//     128263 -> 564
//     128264 -> 565
//     128265 -> 566
//     128266 -> 567
//     128267 -> 568
//     128268 -> 569
//     128269 -> 570
//     128270 -> 571
//     128271 -> 572
//     128272 -> 573
//     128273 -> 574
//     128274 -> 575
//     128275 -> 576
//     128276 -> 577
//     128277 -> 578
//     128278 -> 579
//     128279 -> 580
//     128280 -> 581
//     128281 -> 582
//     128282 -> 583
//     128283 -> 584
//     128284 -> 585
//     128285 -> 586
//     128286 -> 587
//     128287 -> 588
//     128288 -> 589
//     128289 -> 590
//     128290 -> 591
//     128291 -> 592
//     128292 -> 593
//     128293 -> 594
//     128294 -> 595
//     128295 -> 596
//     128296 -> 597
//     128297 -> 598
//     128298 -> 599
//     128299 -> 600
//     128300 -> 601
//     128301 -> 602
//     128302 -> 603
//     128303 -> 604
//     128304 -> 605
//     128305 -> 606
//     128306 -> 607
//     128307 -> 608
//     128308 -> 609
//     128309 -> 610
//     128310 -> 611
//     128311 -> 612
//     128312 -> 613
//     128313 -> 614
//     128314 -> 615
//     128315 -> 616
//     128316 -> 617
//     128317 -> 618
//     128329 -> 619
//     128330 -> 620
//     128331 -> 621
//     128332 -> 622
//     128333 -> 623
//     128334 -> 624
//     128336 -> 625
//     128337 -> 626
//     128338 -> 627
//     128339 -> 628
//     128340 -> 629
//     128341 -> 630
//     128342 -> 631
//     128343 -> 632
//     128344 -> 633
//     128345 -> 634
//     128346 -> 635
//     128347 -> 636
//     128348 -> 637
//     128349 -> 638
//     128350 -> 639
//     128351 -> 640
//     128352 -> 641
//     128353 -> 642
//     128354 -> 643
//     128355 -> 644
//     128356 -> 645
//     128357 -> 646
//     128358 -> 647
//     128359 -> 648
//     128367 -> 649
//     128368 -> 650
//     128371 -> 651
//     128372 -> 652
//     128373 -> 653
//     128374 -> 654
//     128375 -> 655
//     128376 -> 656
//     128377 -> 657
//     128378 -> 658
//     128391 -> 659
//     128394 -> 660
//     128395 -> 661
//     128396 -> 662
//     128397 -> 663
//     128400 -> 664
//     128405 -> 665
//     128406 -> 666
//     128420 -> 667
//     128421 -> 668
//     128424 -> 669
//     128433 -> 670
//     128434 -> 671
//     128444 -> 672
//     128450 -> 673
//     128451 -> 674
//     128452 -> 675
//     128465 -> 676
//     128466 -> 677
//     128467 -> 678
//     128476 -> 679
//     128477 -> 680
//     128478 -> 681
//     128481 -> 682
//     128483 -> 683
//     128488 -> 684
//     128495 -> 685
//     128499 -> 686
//     128506 -> 687
//     128507 -> 688
//     128508 -> 689
//     128509 -> 690
//     128510 -> 691
//     128511 -> 692
//     128512 -> 693
//     128513 -> 694
//     128514 -> 695
//     128515 -> 696
//     128516 -> 697
//     128517 -> 698
//     128518 -> 699
//     128519 -> 700
//     128520 -> 701
//     128521 -> 702
//     128522 -> 703
//     128523 -> 704
//     128524 -> 705
//     128525 -> 706
//     128526 -> 707
//     128527 -> 708
//     128528 -> 709
//     128529 -> 710
//     128530 -> 711
//     128531 -> 712
//     128532 -> 713
//     128533 -> 714
//     128534 -> 715
//     128535 -> 716
//     128536 -> 717
//     128537 -> 718
//     128538 -> 719
//     128539 -> 720
//     128540 -> 721
//     128541 -> 722
//     128542 -> 723
//     128543 -> 724
//     128544 -> 725
//     128545 -> 726
//     128546 -> 727
//     128547 -> 728
//     128548 -> 729
//     128549 -> 730
//     128550 -> 731
//     128551 -> 732
//     128552 -> 733
//     128553 -> 734
//     128554 -> 735
//     128555 -> 736
//     128556 -> 737
//     128557 -> 738
//     128558 -> 739
//     128559 -> 740
//     128560 -> 741
//     128561 -> 742
//     128562 -> 743
//     128563 -> 744
//     128564 -> 745
//     128565 -> 746
//     128566 -> 747
//     128567 -> 748
//     128568 -> 749
//     128569 -> 750
//     128570 -> 751
//     128571 -> 752
//     128572 -> 753
//     128573 -> 754
//     128574 -> 755
//     128575 -> 756
//     128576 -> 757
//     128577 -> 758
//     128578 -> 759
//     128579 -> 760
//     128580 -> 761
//     128581 -> 762
//     128582 -> 763
//     128583 -> 764
//     128584 -> 765
//     128585 -> 766
//     128586 -> 767
//     128588 -> 768
//     128589 -> 769
//     128590 -> 770
//     128591 -> 771
//     128640 -> 772
//     128641 -> 773
//     128642 -> 774
//     128643 -> 775
//     128644 -> 776
//     128645 -> 777
//     128646 -> 778
//     128647 -> 779
//     128648 -> 780
//     128649 -> 781
//     128650 -> 782
//     128651 -> 783
//     128652 -> 784
//     128653 -> 785
//     128654 -> 786
//     128655 -> 787
//     128656 -> 788
//     128657 -> 789
//     128658 -> 790
//     128659 -> 791
//     128660 -> 792
//     128661 -> 793
//     128662 -> 794
//     128663 -> 795
//     128664 -> 796
//     128665 -> 797
//     128666 -> 798
//     128667 -> 799
//     128668 -> 800
//     128669 -> 801
//     128670 -> 802
//     128671 -> 803
//     128672 -> 804
//     128673 -> 805
//     128674 -> 806
//     128675 -> 807
//     128676 -> 808
//     128677 -> 809
//     128678 -> 810
//     128679 -> 811
//     128680 -> 812
//     128681 -> 813
//     128682 -> 814
//     128683 -> 815
//     128684 -> 816
//     128685 -> 817
//     128686 -> 818
//     128687 -> 819
//     128688 -> 820
//     128689 -> 821
//     128690 -> 822
//     128691 -> 823
//     128692 -> 824
//     128693 -> 825
//     128694 -> 826
//     128695 -> 827
//     128696 -> 828
//     128697 -> 829
//     128698 -> 830
//     128699 -> 831
//     128700 -> 832
//     128701 -> 833
//     128702 -> 834
//     128703 -> 835
//     128704 -> 836
//     128705 -> 837
//     128706 -> 838
//     128707 -> 839
//     128708 -> 840
//     128709 -> 841
//     128715 -> 842
//     128716 -> 843
//     128717 -> 844
//     128718 -> 845
//     128719 -> 846
//     128720 -> 847
//     128721 -> 848
//     128722 -> 849
//     128736 -> 850
//     128737 -> 851
//     128738 -> 852
//     128739 -> 853
//     128740 -> 854
//     128741 -> 855
//     128745 -> 856
//     128747 -> 857
//     128748 -> 858
//     128752 -> 859
//     128755 -> 860
//     128756 -> 861
//     128757 -> 862
//     128758 -> 863
//     128759 -> 864
//     128760 -> 865
//     128761 -> 866
//     129296 -> 867
//     129297 -> 868
//     129298 -> 869
//     129299 -> 870
//     129300 -> 871
//     129301 -> 872
//     129302 -> 873
//     129303 -> 874
//     129304 -> 875
//     129305 -> 876
//     129306 -> 877
//     129307 -> 878
//     129308 -> 879
//     129309 -> 880
//     129310 -> 881
//     129311 -> 882
//     129312 -> 883
//     129313 -> 884
//     129314 -> 885
//     129315 -> 886
//     129316 -> 887
//     129317 -> 888
//     129318 -> 889
//     129319 -> 890
//     129320 -> 891
//     129321 -> 892
//     129322 -> 893
//     129323 -> 894
//     129324 -> 895
//     129325 -> 896
//     129326 -> 897
//     129327 -> 898
//     129328 -> 899
//     129329 -> 900
//     129330 -> 901
//     129331 -> 902
//     129332 -> 903
//     129333 -> 904
//     129334 -> 905
//     129335 -> 906
//     129336 -> 907
//     129337 -> 908
//     129338 -> 909
//     129340 -> 910
//     129341 -> 911
//     129342 -> 912
//     129344 -> 913
//     129345 -> 914
//     129346 -> 915
//     129347 -> 916
//     129348 -> 917
//     129349 -> 918
//     129351 -> 919
//     129352 -> 920
//     129353 -> 921
//     129354 -> 922
//     129355 -> 923
//     129356 -> 924
//     129357 -> 925
//     129358 -> 926
//     129359 -> 927
//     129360 -> 928
//     129361 -> 929
//     129362 -> 930
//     129363 -> 931
//     129364 -> 932
//     129365 -> 933
//     129366 -> 934
//     129367 -> 935
//     129368 -> 936
//     129369 -> 937
//     129370 -> 938
//     129371 -> 939
//     129372 -> 940
//     129373 -> 941
//     129374 -> 942
//     129375 -> 943
//     129376 -> 944
//     129377 -> 945
//     129378 -> 946
//     129379 -> 947
//     129380 -> 948
//     129381 -> 949
//     129382 -> 950
//     129383 -> 951
//     129384 -> 952
//     129385 -> 953
//     129386 -> 954
//     129387 -> 955
//     129388 -> 956
//     129389 -> 957
//     129390 -> 958
//     129391 -> 959
//     129392 -> 960
//     129395 -> 961
//     129396 -> 962
//     129397 -> 963
//     129398 -> 964
//     129402 -> 965
//     129404 -> 966
//     129405 -> 967
//     129406 -> 968
//     129407 -> 969
//     129408 -> 970
//     129409 -> 971
//     129410 -> 972
//     129411 -> 973
//     129412 -> 974
//     129413 -> 975
//     129414 -> 976
//     129415 -> 977
//     129416 -> 978
//     129417 -> 979
//     129418 -> 980
//     129419 -> 981
//     129420 -> 982
//     129421 -> 983
//     129422 -> 984
//     129423 -> 985
//     129424 -> 986
//     129425 -> 987
//     129426 -> 988
//     129427 -> 989
//     129428 -> 990
//     129429 -> 991
//     129430 -> 992
//     129431 -> 993
//     129432 -> 994
//     129433 -> 995
//     129434 -> 996
//     129435 -> 997
//     129436 -> 998
//     129437 -> 999
//     129438 -> 1000
//     129439 -> 1001
//     129440 -> 1002
//     129441 -> 1003
//     129442 -> 1004
//     129456 -> 1005
//     129457 -> 1006
//     129458 -> 1007
//     129459 -> 1008
//     129460 -> 1009
//     129461 -> 1010
//     129462 -> 1011
//     129463 -> 1012
//     129464 -> 1013
//     129465 -> 1014
//     129472 -> 1015
//     129473 -> 1016
//     129474 -> 1017
//     129488 -> 1018
//     129489 -> 1019
//     129490 -> 1020
//     129491 -> 1021
//     129492 -> 1022
//     129493 -> 1023
//     // Fallback. This should never happen.
//     _ -> 0
//   }
// }

fn part1(a, b) -> UtfCodepoint {
  a
  |> bitwise.shift_left(2)
  |> bitwise.or(bitwise.shift_right(b, 6))
  |> index_to_emoji
}

fn part2(a, b) -> UtfCodepoint {
  a
  |> bitwise.and(63)
  |> bitwise.shift_left(4)
  |> bitwise.or(bitwise.shift_right(b, 4))
  |> index_to_emoji
}

fn part3(a, b) -> UtfCodepoint {
  a
  |> bitwise.and(15)
  |> bitwise.shift_left(6)
  |> bitwise.or(bitwise.shift_right(b, 2))
  |> index_to_emoji
}

fn part4(a) -> UtfCodepoint {
  case bitwise.and(a, 3) {
    0 -> padding40()
    1 -> padding41()
    2 -> padding42()
    3 -> padding43()
    _ -> padding40()
  }
}

fn part5(a, b) -> UtfCodepoint {
  a
  |> bitwise.and(3)
  |> bitwise.shift_left(8)
  |> bitwise.or(b)
  |> index_to_emoji
}

// TODO: The partN functions return the correct Ints. Why is it that the
// bit_string builds a different value to this version in Rust?
// https://github.com/netvl/ecoji.rs/blob/a8f0dc475ac431d1771a6735adfe46dbbdafc2b8/src/encode.rs#L15-L49
fn do_encode(bytes: BitString, emojis: Iodata) -> Iodata {
  io.debug(bytes)

  case bytes {
    <<>> -> emojis

    <<a:8>> -> {
      let emoji = <<
        part1(a, 0):utf8_codepoint,
        padding():utf8_codepoint,
        padding():utf8_codepoint,
        padding():utf8_codepoint,
      >>
      iodata.append(emojis, bit_string_to_string(emoji))
    }

    <<a:8, b:8>> -> {
      let emoji = <<
        part1(a, b):utf8_codepoint,
        part2(b, 0):utf8_codepoint,
        padding():utf8_codepoint,
        padding():utf8_codepoint,
      >>
      iodata.append(emojis, bit_string_to_string(emoji))
    }

    <<a:8, b:8, c:8>> -> {
      let emoji = <<
        part1(a, b):utf8_codepoint,
        part2(b, c):utf8_codepoint,
        part3(c, 0):utf8_codepoint,
        padding():utf8_codepoint,
      >>
      iodata.append(emojis, bit_string_to_string(emoji))
    }

    <<a:8, b:8, c:8, d:8>> -> {
      let emoji = <<
        part1(a, b):utf8_codepoint,
        part2(b, c):utf8_codepoint,
        part3(c, d):utf8_codepoint,
        part4(d):utf8_codepoint,
      >>
      iodata.append(emojis, bit_string_to_string(emoji))
    }

    <<a:8, b:8, c:8, d:8, e:8, rest:bit_string>> -> {
      let emoji = <<
        part1(a, b):utf8_codepoint,
        part2(b, c):utf8_codepoint,
        part3(c, d):utf8_codepoint,
        part5(d, e):utf8_codepoint,
      >>
      let emojis = iodata.append(emojis, bit_string_to_string(emoji))
      do_encode(rest, emojis)
    }
  }
}

pub fn encode(bytes: BitString) -> String {
  bytes
  |> do_encode(iodata.new(""))
  |> iodata.to_string
}
